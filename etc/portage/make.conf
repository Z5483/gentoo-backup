NTHREADS="4"

#FLTO is of the form -flto[=n] where n is the number of threads to use during linking.
#It's usually a good idea to set this to the number of hardware threads in your system
FLTO="-flto=${NTHREADS}"

#GRAPHITE contains Graphite specific optimizations and other optimizations that are disabled at O3
#but don't influence the compiler's judgement.
#With GCC 8.1.0, -ftree-loop-distribution is enabled by default at -O3
GRAPHITE="-fgraphite-identity -floop-nest-optimize"
#NOTE: To use graphite, make sure you have gcc compiled with graphite support (add graphite to your USE).  Otherwise GCC will complain!

IPAPTA="-fipa-pta"

#IPAPTA contains -fipa* opts that are disabled by default in GCC.  These are interprocedural optimizations.  For now this is only -fipa-pta.
#This option increases compile times, but can potentially produce better binaries, especially with LTO.
#Essentially, it allows the compiler to look into called function bodies when performing alias analysis

SEMINTERPOS="-fno-semantic-interposition"

# With -fno-semantic-interposition the compiler assumes that if interposition happens for functions the overwriting function will have precisely the same semantics (and side effects). Similarly if interposition happens for variables, the constructor of the variable will be the same. The flag has no effect for functions explicitly declared inline (where it is never allowed for interposition to change semantics) and for symbols explicitly declared weak.

NOCOMMON="-fno-common"

# This option only affects C code.  Only non-conformant C code needs -fcommon, which is enabled by default.  Clear Linux leaves this flag off by default.
# We may enable this at some point.  For now, there's a lot of breakages to work through.

SAFEST_FAST_MATH="-fno-math-errno -fno-trapping-math"
SAFER_UNSAFE_MATH_OPTS="-fno-signed-zeros -fno-trapping-math -fassociative-math -freciprocal-math"
SAFER_FAST_MATH="${SAFER_UNSAFE_MATH_OPTS} -fno-math-errno -ffinite-math-only -fno-rounding-math -fno-signaling-nans -fcx-limited-range -fexcess-precision=fast"

#These are flags left off by default that we're planning to start using.  Clear Linux uses these in lieu of full -ffast-math optimizations
#They DO break compliance with ISO C++, so we'll be careful about introducing these.
#Relevant discussion: https://gcc.gnu.org/ml/gcc/2017-09/msg00079.html
#We may end up just going full -Ofast, with exceptions done in the usual way.

DEVIRTLTO="-fdevirtualize-at-ltrans"

#This allows GCC to perform devirtualization across object file boundaries using LTO.  It's off by default because it
#increases compilation time.

NOPLT="-fno-plt"

#This option omits the PLT from the executable, making calls go through the GOT directly.
#It inhibits lazy binding, so this is not enabled by default.  If you use prelink, this is
#strictly better than lazy binding.

CC="gcc"
CXX="g++"

CFLAGS="-march=native -mtune=native -O3 ${DEVIRTLTO} ${GRAPHITE} ${FLTO} \
${IPAPTA} ${SEMINTERPOS} ${NOCOMMON} -fuse-linker-plugin -pipe"
CXXFLAGS="${CFLAGS}"
LDFLAGS="${CFLAGS} -fuse-ld=bfd -Wl,-O1 -Wl,--as-needed -Wl,--sort-common"

AR="gcc-ar"
NM="gcc-nm"
RANLIB="gcc-ranlib"

CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 \
sse4_1 sse4_2 ssse3"

PORTDIR="/var/db/repos/gentoo"

PORTAGE_REPO_DUPLICATE_WARN="0"

PORTAGE_LOGDIR="/var/log/portage"
PORTAGE_LOGDIR_CLEAN="find \"\${PORTAGE_LOGDIR}\" -type f ! -name \
\"summary.log*\" -mtime +7 -delete"

EMERGE_LOG_DIR="/var/log"

PORTAGE_TMPDIR="/var/tmp"

DISTDIR="/var/cache/distfiles"
PKGDIR="/var/cache/binpkgs"

INSTALL_MASK="/usr/share/cursors/xorg-x11/Adwaita"

BINPKG_COMPRESS="bzip2"
BINPKG_COMPRESS_FLAGS="-9"

PORTAGE_COMPRESS="bzip2"
PORTAGE_COMPRESS_FLAGS="-9"

PORTAGE_ELOG_CLASSES="log warn error info"
PORTAGE_ELOG_SYSTEM="save"

PORTAGE_NICENESS="15"
PORTAGE_IONICE_COMMAND="ionice -c 3 -p \${PID}"

EMERGE_DEFAULT_OPTS="--ask --keep-going --with-bdeps=y --verbose"

LC_MESSAGES=C
LINGUAS="en"
L1ON="en_US"

FEATURE="buildpkg ccache cgroup clean-logs fail-clean notitles split-elog \
split-log -test umerge-logs umerge-orphans"

CCACHE_SIZE="10G"
CCACHE_DIR="/var/tmp/ccache"

CMAKE_MAKEFILE_GENERATOR="ninja"

CURL_SSL="libressl"

FFTOOLS=""

VIDEO_CARDS="intel i965"

INPUT_DEVICES="libinput"

ACCEPT_KEYWORDS="~amd64"

ACCEPT_LICENSE="*"

LLVM_TARGETS="X86"

PYTHON_TARGETS="python3_7 python3_8"

QEMU_SOFTMMU_TARGETS="x86_64"
QEMU_USER_TARGETS="x86_64"

RUBY_TARGETS="ruby25 ruby27"

USE="-3dfx -Xaw3d -a52 -aac -aalib -aalib -accessibility -adns -afs    \
-altivec -ao -apache2 -apm -apng -appindicator -aqua -atm -audiofile   \
-audit -avi -ayatana -berkdb -bidi -big-endian -bindist -blas -blas    \
-bluetooth -branding -branding -bzip2 -calender -canna -caps -cdb      \
-cdda -cddb -cdinstall -cdr -cgi -cjk -clamav -colord -consolekit      \
-coreaudio -cracklib -crda -crypt -css -cups -cvs -dbi -dbm -dconf     \
-debug -dedicated -deprecated -djvu -doc -dso -dts -dv -dvb -dvd -dvdr \
-eds -elogind -emacs -examples -exif -expat -fam -fastcgi -fftw        \
-filecaps -firebird -flac -fltk -fortran -freetds -freewnn -fuse -gd   \
-gdbm -geoip -geolocation -ggi -gif -gimp -gles2-only -glut -gmp       \
-gnome -gnome-keyring -gnuplot -gpho2 -gpm -gps -graphviz -gsl -gsm    \
-gstreamer -gtk -gtk-doc -gtk2 -gtk3 -gui -guile -gzip -hdf5 -hscolour \
-ibconv -ibm -iconv -idn -ieee1394 -imagemagick -imap -infiniband      \
-inotify -iodbc -ios -ipod -jack -java -javascript -jbig -jemalloc     \
-jit -jpeg2k -kde -kdrive -kerberos -ladspa -lash -latex -ldap -ldns   \
-libass -libav -libcaca -libedit -libffi -libg++ -libglvnd -libmwww    \
-libnotify -libsamplerate -lirc -lm-sensors -lzo -m17n-lib -magic      \
-matroska -mbox -mikmod -milter -mms -mng -modplug -mono -motif -motif \
-mount -mpeg -mpfr -mpi -mplayer -mssql -mtp -musepack -musicbrainz    \
-mysql -mysqli -nas -neXt -neon -netcdf -netifrc -network -nis -nls    \
-nntp -notifications -nsplugin -objc -objc++ -objc-gc -ocaml -ocamlopt \
-oci8 -odbc -ofx -ogg -opencl -openexr -opus -oracle -oss -pam -pch    \
-pcmcia -pcre -pcre-jit -pda -php -pie -plasma -plotutils -policykit   \
-portaudio -postgres -postscript -ppds -ppp -python -qdbm -qmail-app   \
-qt5 -quicktime -radius -raw -rdoc -rdp -readline -recode -rss -ruby   \
-samba -sasl -sctp -sdl -shm -skey -slang -slang -slp -smartcard       \
-snappy -sndfile -snmp -sound -sox -speex -spell -startup-notification \
-static-libs -subversion -suid -svga -swig -syslog -systray -szip      \
-taglib -tcl -tcmalloc -telemetry -theora -thin -tidy -tiff -timidity  \
-tk -uchardet -udisks -upnp -upnp-av -upower -v4l -vala -vim-syntax    \
-vorbis -wavpack -wayland -webkit -webp -wmf -wxwidgets -xattr -xface  \
-xine -xmp -xmpp -xosd -xpm -xscreensaver -xv -xvfb -z3 -zeroconf      \
-zstd X acl alsa alsa-plugin asm async asyncns cairo clang compiler-rt \
connman cryptsetup curl dav1d dbus default-compiler-rt default-libcxx  \
dri drm egl encode fbcon ffmpeg fontconfig fontforge ftp gallium gbm   \
git glib gnuefi gnutls gpg graphite harfbuzz hpn icu imlib initramfs   \
iwd jpeg kms kvm lame lcms libcxx libcxxabi libcxxrt libressl          \
libunwind libxml2 llvm lto lua luajit lz4 mad minimal modules ncurses  \
nptl openal opengl openh264 orc pango perl pgo png posix prefix        \
pulseaudio qemu session smp sockets spice split-usr sqlite ssl         \
static-analyzer systemd sysv-utils tcpd threads truetype tui udev      \
unicode unwind usb vaapi valgrind vdpau vnc vulkan wifi xft xinerama   \
xml xorg zlib zsh-completion"

GENTOO_MIRRORS="http://www.gtlib.gatech.edu/pub/gentoo \
                rsync://rsync.gtlib.gatech.edu/gentoo  \
                ftp://ftp.ussg.iu.edu/pub/linux/gentoo \
                https://gentoo.ussg.indiana.edu/       \
                http://gentoo.ussg.indiana.edu/        \
                https://gentoo.osuosl.org/             \
                http://gentoo.osuosl.org/              \
                http://gentoo.mirrors.pair.com/        \
                https://mirrors.rit.edu/gentoo/        \
                http://mirrors.rit.edu/gentoo/         \
                ftp://mirrors.rit.edu/gentoo/          \
                rsync://mirrors.rit.edu/gentoo/        \
                https://mirror.sjc02.svwh.net/gentoo/  \
                http://mirror.sjc02.svwh.net/gentoo/   \
                http://gentoo.mirrors.tds.net/gentoo   \
                http://gentoo.cs.utah.edu/"

# vim:set et sw=8 ts=8 tw=80 ft=config:
